---
import { getCollection } from 'astro:content';
import heroThumbnail from '../assets/houston.webp';

const allDocs = await getCollection('docs');
const posts = allDocs
	.filter((entry) => {
		const slug = entry.id || entry.slug || '';
		return slug.startsWith('blog/') && slug !== 'blog.md' && slug !== 'blog';
	})
	.sort((a, b) => {
		const aTime = a.data.date ? new Date(a.data.date).getTime() : 0;
		const bTime = b.data.date ? new Date(b.data.date).getTime() : 0;
		return bTime - aTime;
	});

const formatDate = (date) => {
	if (!date) return '';
	try {
		return new Date(date).toLocaleDateString('zh-CN');
	} catch {
		return String(date);
	}
};
---

<div class="post-grid">
	{posts.map((post) => {
		const slug = post.slug || post.id;
		return (
			<a class="post-card" href={`/${slug}/`}>
				<img
					class="post-thumb"
					src={heroThumbnail.src}
					alt={`${post.data.title} 缩略图`}
					loading="lazy"
				/>
				<div class="post-meta">
					<h3 class="post-title">{post.data.title}</h3>
					{post.data.description && (
						<p class="post-desc">{post.data.description}</p>
					)}
					{post.data.date && (
						<span class="post-date">{formatDate(post.data.date)}</span>
					)}
				</div>
			</a>
		);
	})}
</div>

<style>
	.post-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
		gap: 1.5rem;
		margin-top: 1rem;
	}

	.post-card {
		display: flex;
		flex-direction: column;
		border: 1px solid var(--sl-color-gray-5);
		border-radius: 16px;
		overflow: hidden;
		background: var(--sl-color-gray-7);
		color: inherit;
		text-decoration: none;
		transition: transform 0.2s ease, box-shadow 0.2s ease;
		box-shadow: 0 8px 30px rgba(15, 23, 42, 0.08);
	}

	.post-card:hover {
		transform: translateY(-4px);
		box-shadow: 0 12px 32px rgba(15, 23, 42, 0.16);
	}

	.post-thumb {
		width: 100%;
		aspect-ratio: 16 / 9;
		object-fit: cover;
	}

	.post-meta {
		padding: 1rem 1.2rem 1.25rem;
		display: flex;
		flex-direction: column;
		gap: 0.5rem;
	}

	.post-title {
		margin: 0;
		font-size: 1.05rem;
		font-weight: 600;
		color: var(--sl-color-gray-1);
	}

	.post-desc {
		margin: 0;
		color: var(--sl-color-gray-2);
		font-size: 0.9rem;
		line-height: 1.5;
	}

	.post-date {
		font-size: 0.8rem;
		color: var(--sl-color-gray-3);
	}
</style>
